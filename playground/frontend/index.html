<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Felinto Connect Bot - Debug Playground</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  </head>
  <body>
    <div id="app">
      <header class="header">
        <div class="header-left">
          <h1><i data-lucide="bot"></i> Felinto Connect Bot</h1>
        </div>
        <div class="header-right">
          <button id="docsBtn" class="btn btn-secondary btn-small" title="Abrir Documentação">
            <i data-lucide="book-open"></i>
            Documentação
          </button>
        </div>
      </header>

      <main class="container">
        <section class="config-section">
          <div class="section-header">
            <h2><i data-lucide="settings" class="section-icon"></i> Configuração da Sessão</h2>
            <div class="header-actions">
              <div class="dropdown">
                <button id="importDropdownBtn" class="btn btn-secondary btn-small dropdown-toggle" title="Importar configurações">
                  <i data-lucide="upload"></i>
                  Importar
                  <i data-lucide="chevron-down" class="dropdown-arrow"></i>
                </button>
                <div class="dropdown-menu" id="importDropdownMenu">
                  <button class="dropdown-item" id="importConfig" title="Importar configuração completa do clipboard">
                    <i data-lucide="settings"></i>
                    Configuração Completa
                  </button>
                  <button class="dropdown-item" id="importPuppeteerCookies" title="Importar apenas cookies no formato Puppeteer">
                    <i data-lucide="cookie"></i>
                    Cookies Puppeteer
                  </button>
                </div>
              </div>
              <button id="exportConfig" class="btn btn-secondary btn-small" title="Exportar configurações para clipboard">
                <i data-lucide="download"></i>
                Exportar
              </button>
            </div>
          </div>
          
          <div class="config-group">
            <div class="field">
              <label for="browserWSEndpoint">
                <i data-lucide="link" class="field-icon"></i>
                Browser WebSocket URL
              </label>
              <div class="input-with-inline-button">
                <input type="url" id="browserWSEndpoint" value="ws://localhost:9222">
                <button type="button" id="validateWSEndpoint" class="inline-badge-button" title="Validar conexão com o endpoint WebSocket">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 12l2 2 4-4"></path>
                    <circle cx="12" cy="12" r="10"></circle>
                  </svg>
                  <span>Validar conexão</span>
                </button>
              </div>
              <small>URL do navegador WebSocket</small>
            </div>

            <div class="field">
              <label for="initialUrl">
                <i data-lucide="globe" class="field-icon"></i>
                URL Inicial
              </label>
              <input type="url" id="initialUrl" value="https://twitter.com/login">
              <small>Página inicial a ser carregada</small>
            </div>

            <div class="field">
              <label>
                <i data-lucide="database" class="field-icon"></i>
                Session Data (JSON)
              </label>
              <textarea id="sessionData" rows="6">{
  "localStorage": {
    "userPreferred_language": "pt-BR",
    "currency": "BRL"
  }
}</textarea>
              <small>Dados completos da sessão (cookies, localStorage, sessionStorage)</small>
              
              <!-- Session Data Templates -->
              <div class="session-templates" style="margin-top: 10px;">
                <label style="font-size: 12px; color: #666; margin-bottom: 5px; display: block;">
                  <i data-lucide="zap" style="width: 12px; height: 12px;"></i>
                  Templates Rápidos:
                </label>
                <div class="session-template-buttons" style="display: flex; gap: 5px; flex-wrap: wrap;">
                  <button type="button" class="session-template-btn" data-session-template="clear-all" style="font-size: 11px; padding: 6px 10px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">
                    <i data-lucide="trash-2" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                    Limpar Tudo
                  </button>
                  <button type="button" class="session-template-btn" data-session-template="clear-cookies" style="font-size: 11px; padding: 6px 10px; background: #f97316; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#ea580c'" onmouseout="this.style.background='#f97316'">
                    <i data-lucide="cookie" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                    Só Cookies
                  </button>
                  <button type="button" class="session-template-btn" data-session-template="clear-localStorage" style="font-size: 11px; padding: 6px 10px; background: #8b5cf6; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#7c3aed'" onmouseout="this.style.background='#8b5cf6'">
                    <i data-lucide="hard-drive" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                    Só localStorage
                  </button>
                  <button type="button" class="session-template-btn" data-session-template="clear-sessionStorage" style="font-size: 11px; padding: 6px 10px; background: #06b6d4; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#0891b2'" onmouseout="this.style.background='#06b6d4'">
                    <i data-lucide="database" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                    Só sessionStorage
                  </button>
                  <button type="button" class="session-template-btn" data-session-template="empty" style="font-size: 11px; padding: 6px 10px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'">
                    <i data-lucide="minimize-2" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                    {} Vazio
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="config-group">
            <div class="advanced-main-header">
              <h3><i data-lucide="settings" class="subsection-icon"></i> Configurações Avançadas</h3>
              <button id="toggleAdvancedConfig" class="advanced-toggle-btn" title="Mostrar/Ocultar configurações avançadas">
                <i data-lucide="chevron-down" class="toggle-icon"></i>
                <span class="toggle-text">Mostrar Configurações</span>
              </button>
            </div>
            
            <div id="advancedConfigContent" class="advanced-config-content collapsed">
              <!-- Subgrupo: Configurações do Browser -->
              <div class="browser-config-subgroup">
                <h4><i data-lucide="chrome" class="browser-section-icon"></i> Configurações do Browser</h4>
                
                <div class="config-row">
                  <div class="field half-width">
                    <label for="slowMo">
                      <i data-lucide="clock" class="field-icon"></i>
                      Slow Motion (ms)
                    </label>
                    <input type="number" id="slowMo" value="80" min="0" max="5000" step="10">
                    <small>Velocidade de execução (0 = máximo)</small>
                  </div>
                  
                  <div class="field half-width">
                    <label for="timeout">
                      <i data-lucide="timer" class="field-icon"></i>
                      Timeout (segundos)
                    </label>
                    <input type="number" id="timeout" value="120" min="10" max="300" step="10">
                    <small>Timeout para navegação e operações</small>
                  </div>
                </div>

                <div class="field">
                  <label for="userAgent">
                    <i data-lucide="monitor" class="field-icon"></i>
                    User Agent
                  </label>
                  <input type="text" id="userAgent" value="Mozilla/5.0 (iPhone; CPU iPhone OS 1">
                  <small>Agente do usuário personalizado</small>
                  
                  <!-- User Agent Templates -->
                  <div class="ua-templates" style="margin-top: 10px;">
                    <label style="font-size: 12px; color: #666; margin-bottom: 5px; display: block;">
                      <i data-lucide="zap" style="width: 12px; height: 12px;"></i>
                      Templates Rápidos:
                    </label>
                    <div class="ua-template-buttons" style="display: flex; gap: 5px; flex-wrap: wrap;">
                      <button type="button" class="ua-template-btn" data-ua-template="current-browser" style="font-size: 11px; padding: 6px 10px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#d97706'" onmouseout="this.style.background='#f59e0b'">
                        <i data-lucide="user" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                        Navegador Atual
                      </button>
                      <button type="button" class="ua-template-btn" data-ua-template="chrome-desktop" style="font-size: 11px; padding: 6px 10px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">
                        <i data-lucide="monitor" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                        Chrome Desktop
                      </button>
                      <button type="button" class="ua-template-btn" data-ua-template="safari-desktop" style="font-size: 11px; padding: 6px 10px; background: #6366f1; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#4f46e5'" onmouseout="this.style.background='#6366f1'">
                        <i data-lucide="monitor" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                        Safari Desktop
                      </button>
                      <button type="button" class="ua-template-btn" data-ua-template="iphone" style="font-size: 11px; padding: 6px 10px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'">
                        <i data-lucide="smartphone" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                        iPhone
                      </button>
                      <button type="button" class="ua-template-btn" data-ua-template="android" style="font-size: 11px; padding: 6px 10px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'">
                        <i data-lucide="smartphone" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                        Android
                      </button>
                      <button type="button" class="ua-template-btn" data-ua-template="clear" style="font-size: 11px; padding: 6px 10px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center;" onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">
                        <i data-lucide="x" style="width: 12px; height: 12px; margin-right: 4px;"></i>
                        Limpar
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Código Gerado -->
          <div class="config-group" id="headerCodeGroup">
            <h3><i data-lucide="code" class="subsection-icon"></i> Código Gerado</h3>
            <div class="code-section">
              <div id="headerEditor" class="code-editor-container"></div>
            </div>
          </div>

          <div class="config-group">
            <h3><i data-lucide="layout-template" class="subsection-icon"></i> Templates Rápidos</h3>
            <div class="template-buttons">
              <button class="template-btn" data-template="basic">
                <i data-lucide="rocket" class="template-icon"></i>
                Básico
              </button>
              <button class="template-btn" data-template="ecommerce">
                <i data-lucide="shopping-cart" class="template-icon"></i>
                E-commerce
              </button>
              <button class="template-btn" data-template="social">
                <i data-lucide="smartphone" class="template-icon"></i>
                Social Media
              </button>
              <button class="template-btn" data-template="scraping">
                <i data-lucide="search" class="template-icon"></i>
                Scraping
              </button>
            </div>
          </div>
        </section>

        <section class="execution-section">
          <div class="section-header">
            <h2><i data-lucide="play" class="section-icon"></i> Execução</h2>
            <div class="header-actions">
              <button id="copyCodeBtn" class="btn btn-secondary btn-small" title="Copiar código completo para clipboard">
                <i data-lucide="copy"></i>
                Copiar Código
              </button>
            </div>
          </div>
          




          <!-- Código da Automação -->
          <div class="execution-group" id="automationCodeGroup">
            <h3><i data-lucide="bot" class="subsection-icon"></i> Código da Automação</h3>
            <div class="code-section">
              <div id="automationEditor" class="code-editor-container"></div>
            </div>
          </div>

          <!-- Extração de dados e encerramento da sessão -->
          <div class="execution-group" id="footerCodeGroup">
            <h3><i data-lucide="database" class="subsection-icon"></i> Extração de dados e encerramento da sessão</h3>
            <div class="code-section">
              <div id="footerEditor" class="code-editor-container"></div>
            </div>
            <div class="action-buttons" style="margin-top: 15px;">
              <button id="sessionToggleBtn" class="btn btn-success" title="Criar nova sessão Puppeteer">
                <i data-lucide="plus-circle"></i>
                Criar Sessão
              </button>
              <button id="executeCodeBtn" class="btn btn-primary" title="Executar automação na sessão ativa" disabled>
                <i data-lucide="play"></i>
                Executar Automação
              </button>
              <button id="takeScreenshotBtn" class="btn btn-secondary" title="Tirar screenshot da página" disabled>
                <i data-lucide="camera"></i>
                Tirar Screenshot
              </button>
            </div>
          </div>

          <!-- Results Section -->
          <div class="execution-group" id="resultsSection">
            <h3><i data-lucide="clipboard-list" class="subsection-icon"></i> Resultados da Execução</h3>
            
            <div class="results-tabs">
              <button class="tab-btn active" data-tab="screenshot">
                <i data-lucide="camera"></i>
                Screenshot
              </button>
              <button class="tab-btn" data-tab="data">
                <i data-lucide="download"></i>
                Dados Extraídos
              </button>
              <button class="tab-btn" data-tab="pageinfo">
                <i data-lucide="info"></i>
                Info da Página
              </button>
            </div>
            
            <div class="results-content">
              <div id="screenshotTab" class="tab-content active">
                <div id="screenshotContainer" class="screenshot-container">
                  <p class="empty-state">Nenhum screenshot capturado ainda</p>
                </div>
              </div>
              
              <div id="dataTab" class="tab-content">
                <div id="dataContainer" class="data-container">
                  <pre class="code-output"><code>// Dados extraídos aparecerão aqui...</code></pre>
                </div>
              </div>
              
              <div id="pageinfoTab" class="tab-content">
                <div id="pageInfoContainer" class="page-info-container">
                  <div class="info-item">
                    <label>URL:</label>
                    <span id="currentUrl">-</span>
                  </div>
                  <div class="info-item">
                    <label>Título:</label>
                    <span id="currentTitle">-</span>
                  </div>
                  <div class="info-item">
                    <label>Última atualização:</label>
                    <span id="lastUpdate">-</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="execution-group">
            <h3><i data-lucide="terminal" class="subsection-icon"></i> Console de Saída</h3>
            <div id="logs" class="console-output">
              <!-- Logs serão adicionados dinamicamente -->
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Documentation Modal -->
    <div id="docsModal" class="modal" style="display: none;">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2><i data-lucide="book-open"></i> Documentação - Felinto Connect Bot</h2>
          <button id="closeDocsModal" class="modal-close" title="Fechar">
            <i data-lucide="x"></i>
          </button>
        </div>
        <div class="modal-body">
          <div id="docsContent" class="docs-content">
            <div class="loading-spinner">
              <i data-lucide="loader-2"></i>
              Carregando documentação...
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <script type="module" src="/src/main.js"></script>
    <script>
      // Inicializar ícones Lucide após carregamento
      document.addEventListener('DOMContentLoaded', () => {
        const initIcons = () => {
          if (typeof lucide !== 'undefined') {
            try {
              lucide.createIcons();
            } catch (error) {
              console.error('Erro na inicialização dos ícones:', error);
            }
          } else {
            setTimeout(initIcons, 50);
          }
        };
        initIcons();
      });
    </script>
  </body>
</html>
